<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <link rel="stylesheet" href="./css/size.css" />
    <link rel="stylesheet" href="./css/sample.css" />
    <title>Document</title>
  </head>
  <body>
    <div class="logo">
      <a href=""
        ><img class="logoimg" src="./image/タイトル2_仮_-removebg-preview.png"
      /></a>
    </div>
    <div class="center">
      カテゴリ<br/>
      <select id="category" class="radis" required>
        <option value="" class="cen" hidden>カテゴリを選択してください</option>
        <option value="観光" class="cen">観光</option>
        <option value="グルメ" class="cen">グルメ</option></select
      ><br />
      <div class="pulldownset">
        場所<br />
        <select class="mainselect" id="select" required>
          <option value="" hidden>場所を選択してください</option>
          <option value="北海道">北海道</option>
          <option value="東北">東北</option>
          <option value="関東">関東</option>
          <option value="中部">中部</option>
          <option value="近畿">近畿</option>
          <option value="中国">中国</option>
          <option value="四国">四国</option>
          <option value="九州">九州</option></select
        ><br />
        <!-- <label for="foo" class="ditail">より詳しく</label><br />
        <input type="checkbox" name="foo" id="foo" required/>
        <div id="bar"> -->
          <!-- ================================================================ -->
          <!-- (※2)▼項目「北海道」に対応する2段階目(サブ)のプルダウンメニュー -->
          <select id="北海道" class="subbox" required>
            <option value="" hidden>北海道を選択</option>
            <option value="北海道">北海道</option>
          </select>

          <!-- ================================================================ -->
          <!-- (※3)▼項目「東北地方」に対応する2段階目(サブ)のプルダウンメニュー -->
          <select id="東北" class="subbox" required>
            <option value="" hidden>東北地方の県を選択</option>
            <option value="青森">青森県</option>
            <option value="秋田">秋田県</option>
            <option value="岩手">岩手県</option>
            <option value="宮城">宮城県</option>
            <option value="山形">山形県</option>
            <option value="福島">福島県</option>
          </select>

          <!-- ================================================================ -->
          <!-- (※4)▼項目「関東地方」に対応する2段階目(サブ)のプルダウンメニュー -->
          <select id="関東" class="subbox" required>
            <option value="" hidden>関東地方の県・都を選択</option>
            <option value="東京">東京都</option>
            <option value="千葉">千葉県</option>
            <option value="埼玉">埼玉県</option>
            <option value="神奈川">神奈川県</option>
            <option value="群馬">群馬県</option>
            <option value="栃木">栃木県</option>
            <option value="茨城">茨城県</option>
          </select>

          <!-- ================================================================ -->
          <!-- (※4)▼項目「中部地方」に対応する2段階目(サブ)のプルダウンメニュー -->
          <select id="中部" class="subbox" required>
            <option value="" hidden>中部地方の県を選択</option>
            <option value="新潟">新潟県</option>
            <option value="山梨">山梨県</option>
            <option value="静岡">静岡県</option>
            <option value="長野">長野県</option>
            <option value="岐阜">岐阜県</option>
            <option value="愛知">愛知県</option>
            <option value="富山">富山県</option>
            <option value="石川">石川県</option>
            <option value="福井">福井県</option>
          </select>

          <!-- ================================================================ -->
          <!-- (※4)▼項目「近畿地方」に対応する2段階目(サブ)のプルダウンメニュー -->
          <select id="近畿" class="subbox" required>
            <option value="" hidden>近畿地方の県・府を選択</option>
            <option value="京都">京都府</option>
            <option value="大阪">大阪府</option>
            <option value="滋賀">滋賀県</option>
            <option value="兵庫">兵庫県</option>
            <option value="奈良">奈良県</option>
            <option value="和歌山">和歌山県</option>
            <option value="三重">三重県</option>
          </select>

          <!-- ================================================================ -->
          <!-- (※4)▼項目「中国地方」に対応する2段階目(サブ)のプルダウンメニュー -->
          <select id="中国" class="subbox" required>
            <option value="" hidden>中国地方の県を選択</option>
            <option value="鳥取">鳥取県</option>
            <option value="島根">島根県</option>
            <option value="岡山">岡山県</option>
            <option value="広島">広島県</option>
            <option value="山口">山口県</option>
          </select>

          <!-- ================================================================ -->
          <!-- (※4)▼項目「四国地方」に対応する2段階目(サブ)のプルダウンメニュー -->
          <select id="四国" class="subbox" required>
            <option value="" hidden>四国地方の県を選択</option>
            <option value="愛媛">愛媛県</option>
            <option value="高知">高知県</option>
            <option value="徳島">徳島県</option>
            <option value="香川">香川県</option>
          </select>

          <!-- ================================================================ -->
          <!-- (※4)▼項目「九州地方」に対応する2段階目(サブ)のプルダウンメニュー -->
          <select id="九州" class="subbox" required>
            <option value="" hidden>九州地方の県を選択</option>
            <option value="福岡">福岡県</option>
            <option value="佐賀">佐賀県</option>
            <option value="長崎">長崎県</option>
            <option value="熊本">熊本県</option>
            <option value="大分">大分県</option>
            <option value="宮崎">宮崎県</option>
            <option value="鹿児島">鹿児島県</option>
            <option value="沖縄">沖縄県</option>
          </select>
        </div>
      </div>
      <!-- <p id="status">処理中...</p> -->
      <img src="../image/nekotoaruku_touka.gif" alt="neko">
      <p id="status"><img id="loadingGif" src="../image/nekotoaruku_touka.gif" alt="Loading..." style="display: none;"></p>
      <br /><button
        id="mapper"
        style="
          background-color: #ffc684;
          color: white;
          width: 300px;
          height: 60px;
          font-size: 20px;
          border-radius: 10px;
        "
      >
        現在地を取得して経路を出す
      </button>
      <br />
    </div>
    <script src="./js/map.js"></script>
    <script
      type="text/javascript"
      src="https://code.jquery.com/jquery-1.12.4.js"
    ></script>
    <!-- <script>
      $(function () {
        $("input#foo[type=checkbox]").click(function () {
          if ($(this).prop("checked")) {
            $("#bar").show();
          } else {
            $("#bar").hide();
          }
        });
      });
    </script> -->
    <script>
      let combinedValue = "";
      let bool = "";
      // ボタン要素を取得
      var executePythonButton = document.getElementById("mapper");

      executePythonButton.addEventListener("click", () => {

        const Select = document.getElementById("select");
        const subSelect = document.getElementById(Select.value);
        const categorySelect = document.getElementById("category");
        const checkBox = document.getElementById("foo");
        
        if(Select.value === "" || categorySelect.value === "" ){
          alert("カテゴリまたは場所を選択して下さい");
          bool = "false";
        }else if(subSelect.value !== ""){
          const selectedsub = subSelect.value;
          const selectedCategory = categorySelect.value;
          // 選択された県とカテゴリを結合
          combinedValue = selectedsub + selectedCategory;
          console.log(combinedValue);
          bool = "true";
        }else{
          alert("地域を選択してください");
          bool = "false";
        }

        if(bool == "true"){
          const statusElement = document.getElementById("status");
          const loadingGif = document.getElementById("loadingGif");
          statusElement.style.display = 'block';
          loadingGif.style.display = 'block';
          // statusElement.textContent = '処理中...';

        // テキストボックスの値をサーバーに送信してハッシュタグを変更
        fetch("http://localhost:3000/changeHashtag", {
          method: "POST", // POST リクエストを送信
          headers: {
            "Content-Type": "application/json",
            // 他の必要なヘッダーがあれば追加
          },
          body: JSON.stringify({ newHashtag: combinedValue }), // リクエストボディにデータを送信
        })
          .then((response) => response.json())
          .then((data) => {
            // 最初のfetchリクエストが完了した後に実行されるコード
            // alert(data.message);

            console.log("起動中です");
            // 2つめのfetchリクエストを実行
            loadingGif.style.display = 'none';
            // statusElement.textContent = 'API呼び出し成功。処理中...';
            return fetch("http://localhost:3000/runcode");
          })
          .then((response) => response.json())
          .then((data) => {
            // 2つめのfetchリクエストが完了した後に実行されるコード
            addresses = data; // サーバーからのデータをJavaScriptの配列として直接取得
            console.log("Addresses:", addresses);
            localStorage.setItem("Addresses", JSON.stringify(addresses));
            location.href = `./index7.html?20231114c`;
          })
          .catch((error) => {
            console.error("Error:", error);
            loadingGif.style.display = 'none';
            statusElement.textContent = 'エラーが発生しました。';
          });
         }

      });
    </script>
    <script type="text/javascript">
      // ▼HTMLの読み込み直後に実行：
      document.addEventListener("DOMContentLoaded", function () {
        // ▼2階層目の要素を全て非表示にする
        var allSubBoxes = document.getElementsByClassName("subbox");
        for (var i = 0; i < allSubBoxes.length; i++) {
          allSubBoxes[i].style.display = "none";
        }
      });
    </script>
    <script type="text/javascript">
      // ▼HTMLの読み込み直後に実行：
      document.addEventListener("DOMContentLoaded", function () {
        // ▼全てのプルダウンメニューセットごとに処理
        var mainBoxes = document.getElementsByClassName("pulldownset");
        for (var i = 0; i < mainBoxes.length; i++) {
          var mainSelect = mainBoxes[i].getElementsByClassName("mainselect"); // 1階層目(メイン)のプルダウンメニュー（※後でvalue属性値を参照するので、select要素である必要があります。）
          mainSelect[0].onchange = function () {
            // ▼同じ親要素に含まれているすべての2階層目(サブ)要素を消す
            var subBox = this.parentNode.getElementsByClassName("subbox"); // 同じ親要素に含まれる.subbox（※select要素に限らず、どんな要素でも構いません。）
            for (var j = 0; j < subBox.length; j++) {
              subBox[j].style.display = "none";
            }

            // ▼指定された2階層目(サブ)要素だけを表示する
            if (this.value) {
              var targetSub = document.getElementById(this.value); // 「1階層目のプルダウンメニューで選択されている項目のvalue属性値」と同じ文字列をid属性値に持つ要素を得る
              targetSub.style.display = "inline";
            }
          };
        }
      });
    </script>
  </body>
</html>
