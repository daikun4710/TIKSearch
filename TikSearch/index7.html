<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width,intial-scale=1"/>
    <meta charset="UTF-8" />
    <link rel="stylesheet" href="https://pyscript.net/latest/pyscript.css" />
    <link rel="stylesheet" href="./css/map.css">
    <script defer src="https://pyscript.net/latest/pyscript.js"></script>
    <title>Google Map with Info Window and Link</title>
    <style>
      #map {
        height: 400px;
        width: 100%;
      }
    </style>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.2/font/bootstrap-icons.min.css">
  </head>
  <body>
    <div id="map"></div>
    <div id="search-box-container" class="flex_test-box">
    <div class="flex_test-item">
      <form action="#">
        <!-- <label for="category">ã‚«ãƒ†ã‚´ãƒª</label> -->
        <select id="category">
          <option value="sightseeing">è¦³å…‰</option>
          <option value="foods">ã‚°ãƒ«ãƒ¡</option>
        </select>
      <form action="#">
        <!-- <label for="place">çœŒ</label> -->
        <select name="place" id="place">
          <option value="ho">åŒ—æµ·é“</option>
          <option value="aomori">é’æ£®çœŒ</option>
          <option value="akita">ç§‹ç”°çœŒ</option>
          <option value="iwate">å²©æ‰‹çœŒ</option>
          <option value="miyagi">å®®åŸçœŒ</option>
          <option value="yamagata">å±±å½¢çœŒ</option>
          <option value="hukusima">ç¦å³¶çœŒ</option>
          <option value="tokyo">æ±äº¬éƒ½</option>
          <option value="tiba">åƒè‘‰çœŒ</option>
          <option value="saitama">åŸ¼ç‰çœŒ</option>
          <option value="kanagawa">ç¥å¥ˆå·çœŒ</option>
          <option value="gunma">ç¾¤é¦¬çœŒ</option>
          <option value="totigi">æ ƒæœ¨çœŒ</option>
          <option value="ibaraki">èŒ¨åŸçœŒ</option>
          <option value="nigata">æ–°æ½ŸçœŒ</option>
          <option value="yamanasi">å±±æ¢¨çœŒ</option>
          <option value="sizuoka">é™å²¡çœŒ</option>
          <option value="nagano">é•·é‡çœŒ</option>
          <option value="gihu">å²é˜œçœŒ</option>
          <option value="aichi">æ„›çŸ¥çœŒ</option>
          <option value="toyama">å¯Œå±±çœŒ</option>
          <option value="isii">çŸ³äº•çœŒ</option>
          <option value="hukui">ç¦äº•çœŒ</option>
          <option value="kyoto">äº¬éƒ½åºœ</option>
          <option value="osaka">å¤§é˜ªåºœ</option>
          <option value="siga">æ»‹è³€çœŒ</option>
          <option value="hyogo">å…µåº«çœŒ</option>
          <option value="nara">å¥ˆè‰¯çœŒ</option>
          <option value="wakayama">å’Œæ­Œå±±çœŒ</option>
          <option value="mie">ä¸‰é‡çœŒ</option>
          <option value="totori">é³¥å–çœŒ</option>
          <option value="simane">å³¶æ ¹çœŒ</option>
          <option value="okayama">å²¡å±±çœŒ</option>
          <option value="hirosima">åºƒå³¶çœŒ</option>
          <option value="yamaguti">å±±å£çœŒ</option>
          <option value="ehime">æ„›åª›çœŒ</option>
          <option value="koti">é«˜çŸ¥çœŒ</option>
          <option value="tokusima">å¾³å³¶çœŒ</option>
          <option value="kagawa">é¦™å·çœŒ</option>
          <option value="hukuoka">ç¦å²¡çœŒ</option>
          <option value="saga">ä½è³€çœŒ</option>
          <option value="nagaskai">é•·å´çœŒ</option>
          <option value="kumamoto">ç†Šæœ¬çœŒ</option>
          <option value="oita">å¤§åˆ†çœŒ</option>
          <option value="miyazaki">å®®å´çœŒ</option>
          <option value="kagosima">é¹¿å…å³¶çœŒ</option>
          <option value="okinawa">æ²–ç¸„çœŒ</option>
          </select>
          <button type="button" class="btn btn-primary">æ¤œç´¢</button>
      </form>
    </div>
    </div>
    <div id="map"></div>
    <script>
      var map;
      var infoWindow;

      function initMap() {
        // ãƒãƒƒãƒ—ã‚’è¡¨ç¤ºã™ã‚‹ãŸã‚ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’è¨­å®š
        var mapOptions = {
          center: { lat: 0, lng: 0 }, // ãƒãƒƒãƒ—ã®åˆæœŸä¸­å¿ƒä½ç½®
          zoom: 15, // ã‚ºãƒ¼ãƒ ãƒ¬ãƒ™ãƒ«ï¼ˆ1ãŒæœ€å°ã€20ãŒæœ€å¤§ï¼‰
        };
        // åœ°å›³ã‚’ä½œæˆ
        var map = new google.maps.Map(
          document.getElementById("map"),
          mapOptions
        );
        // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç¾åœ¨ä½ç½®ã‚’å–å¾—ã—ã¦åœ°å›³ä¸Šã«è¡¨ç¤º
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(
            function (position) {
              var userLocation = {
                lat: position.coords.latitude,
                lng: position.coords.longitude,
              };

              // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ä½ç½®ã«ãƒãƒ¼ã‚«ãƒ¼ã‚’è¿½åŠ 
              new google.maps.Marker({
                position: userLocation,
                map: map,
                title: "ç¾åœ¨ã®ä½ç½®",
              });

              // ãƒãƒƒãƒ—ã‚’ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ä½ç½®ã«ç§»å‹•
              map.setCenter(userLocation);
              map.setZoom(15);
            },
            function (error) {
              // ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
              console.error(
                "ä½ç½®æƒ…å ±ã‚’å–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚ã‚¨ãƒ©ãƒ¼: " + error.message
              );
            }
          );
        } else {
          // ãƒ–ãƒ©ã‚¦ã‚¶ãŒä½ç½®æƒ…å ±ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ãªã„å ´åˆã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
          console.error("ã“ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯ä½ç½®æƒ…å ±ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã›ã‚“ã€‚");
        }

        // æƒ…å ±ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’åˆæœŸåŒ–
        infoWindow = new google.maps.InfoWindow();

        // ãƒ”ãƒ³ã‚’ç«‹ã¦ãŸã„ä½æ‰€
        var address =
          "æ°´æ·±162cmã®æ—¥æœ¬ä¸€æ·±ã„æ¸©æ³‰ãŒã‚„ã°ã™ããŸâ€¦173cmã®ä¿ºã¯æ¯å‡ºæ¥ãªã‹ã£ãŸğŸ¤£ ğŸ“ç†Šæœ¬çœŒå—å°å›½ç”ºã€€ã“ã†ã®æ¹¯ #ç†Šæœ¬ #ã“ã†ã®æ¹¯ #ç†Šæœ¬æ¸©æ³‰";

        // ã‚¸ã‚ªã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’å®Ÿè¡Œ
        var geocoder = new google.maps.Geocoder();
        geocoder.geocode({ address: address }, function (results, status) {
          if (status === "OK") {
            var location = results[0].geometry.location;

            // ãƒ”ãƒ³ã‚’ä½œæˆ
            var marker = new google.maps.Marker({
              position: location,
              map: map,
              title: address,
            });

            // è©³ç´°æƒ…å ±ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã®å†…å®¹
            var contentString =
              "<div>ã‚µãƒ³ãƒ—ãƒ«<h3>" +
              address +
              '</h3><p>è©³ç´°æƒ…å ±ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</p><p><a href="https://www.tiktok.com/@yuuuuto38/video/7293401284609150216?q=%E7%A6%8F%E5%B2%A1%E8%A6%B3%E5%85%89&t=7150595195619282178" target="_blank">ã‚µã‚¤ãƒˆã¸ã®ãƒªãƒ³ã‚¯</a></p></div>';

            // ãƒ”ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸã¨ãã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
            marker.addListener("click", function () {
              // è©³ç´°æƒ…å ±ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã«å†…å®¹ã‚’ã‚»ãƒƒãƒˆ
              infoWindow.setContent(contentString);

              // ãƒ”ãƒ³ã®ä½ç½®ã«ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’è¡¨ç¤º
              infoWindow.open(map, marker);
            });
          } else {
            alert("ã‚¸ã‚ªã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã«å¤±æ•—ã—ã¾ã—ãŸ: " + status);
          }
        });
      }
      var dataArray = JSON.parse(localStorage.getItem("Addresses"));
      //æ¤œç´¢æƒ…å ±å‡ºåŠ›
      console.log(dataArray);
    </script>

    <script
      async
      defer
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCUqiDP-1T8cxCyJRYrel2GIcAlz5_vgAE&callback=initMap"
    ></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-Fy6S3B9q64WdZWQUiU+q4/2Lc9npb8tCaSX9FK7E8HnRr0Jz8D6OP9dO5Vg3Q9ct" crossorigin="anonymous"></script>
  </body>
</html>
