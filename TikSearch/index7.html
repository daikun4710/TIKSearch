<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <link rel="stylesheet" href="https://pyscript.net/latest/pyscript.css" />
  <script defer src="https://pyscript.net/latest/pyscript.js"></script>
  <title>Google Map with Info Window and Link</title>
  <style>
     body{
      margin:0;
    }

    #map {
      height: 400px;
      width: 100%;
    }

    #addressesList {
      position: absolute;
      top: 430px;
    }

    .serach {
      position: absolute;
      top: 380px;
      left: 10px;
      font-size: 25px;
    }

    ul {
      counter-reset: number;
      /* カウンターをリセット */
      list-style-type: none !important;
      /* 番号を消す */
      padding: 0.3em 0.8em;
      border: solid 2px #ffb107;
    }

    ul li {
      border-bottom: dashed 1px orange;
      position: relative;
      padding: 0.5em 0.5em 0.5em 30px;
      line-height: 1.5em;
      counter-increment: number;
      /* 各li要素ごとにカウンターを増やす */
    }

    ul li:after {
      /* ここで番号を指定 */
      position: absolute;
      content: counter(number);
      /* カウンターの値を表示 */
      /* 番号のスタイル */
      display: inline-block;
      background: #ffb107;
      color: white;
      font-family: 'Avenir', 'Arial Black', 'Arial', sans-serif;
      font-weight: bold;
      font-size: 15px;
      border-radius: 50%;
      left: 0;
      width: 25px;
      height: 25px;
      line-height: 25px;
      text-align: center;
      /* 縦方向の中央揃え */
      top: 50%;
      -webkit-transform: translateY(-50%);
      transform: translateY(-50%);
    }

    ul li:last-of-type {
      border-bottom: none;
      /* 最後のliの線だけ消す */
    }
  </style>
</head>
<body>
  <p class="serach">検索一覧🔍</p>
  <div id="map"></div>
  <div>
    <ul id="addressesList">
    </ul>
  </div>
  <canvas id="Canvas"></canvas>
  <script>
    var map;
    var infoWindow;
    function initMap() {
      // マップを表示するためのオプションを設定
      var mapOptions = {
        center: { lat: 0, lng: 0 }, // マップの初期中心位置
        zoom: 15, // ズームレベル（1が最小、20が最大）
      };
      // 地図を作成
      map = new google.maps.Map(
        document.getElementById("map"),
        mapOptions
      );
      // ユーザーの現在位置を取得して地図上に表示
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          function (position) {
            var userLocation = {
              lat: position.coords.latitude,
              lng: position.coords.longitude,
            };
            // ユーザーの位置にマーカーを追加
            new google.maps.Marker({
              position: userLocation,
              map: map,
              title: "現在の位置",
            });
            // マップをユーザーの位置に移動
            map.setCenter(userLocation);
            map.setZoom(15);
          },
          function (error) {
            // エラーメッセージを表示
            console.error(
              "位置情報を取得できませんでした。エラー: " + error.message
            );
          }
        );
      } else {
        // ブラウザが位置情報をサポートしていない場合のメッセージ
        console.error("このブラウザは位置情報をサポートしていません。");
      }
      // 情報ウィンドウを初期化
      infoWindow = new google.maps.InfoWindow();
      // ピンを立てたい住所
      var addressArray = [
        "水深162cmの日本一深い温泉がやばすぎた…173cmの俺は息出来なかった🤣 📍熊本県南小国町　こうの湯 #熊本 #こうの湯 #熊本温泉",
        "糸島で1番うまいと噂の焼肉屋さん調査してきたカンジャンケジャン食べ放題は最高すぎる📍福岡県糸島市　#上の焼肉屋\お店の公式アカウント→ @ueno.yakinikuyaOpen 11:00〜20:00※水曜定休日",
        "まるでテーマパークみたいな福岡の穴場絶景ホテルが最高すぎた件について😳♨️一見めちゃくちゃ高そうに見えるこのホテル…ここだけの話意外とお手頃な値段で泊まれちゃうんだ🤫大人数でも泊まれるし今からの忘年会シーズンにも持ってこいの宿だぜ❤️‍🔥👍🏻📍福岡県岡垣町　#海辺の鮨宿八幡屋※予約方法やプランの料金詳細は公式サイトからチェックしてね🔥"
      ];
      // Log and display each address in the array
      var addressesList = document.getElementById("addressesList");
      for (var i = 0; i < addressArray.length; i++) {
        console.log("Address " + (i + 1) + ": " + addressArray[i]);
        // Display addresses as a list
        addressesList.innerHTML += "<li>SPOT " + (i + 1) + ":" + addressArray[i] + "</li>";
      }
      // ジオコーディングを実行
      for (var i = 0; i < addressArray.length; i++) {
        geocodeAddress(addressArray[i]);
      }
    }
    function geocodeAddress(address) {
      var geocoder = new google.maps.Geocoder();
      geocoder.geocode({ address: address }, function (results, status) {
        if (status === "OK") {
          var location = results[0].geometry.location;
          // ピンを作成
          var marker = new google.maps.Marker({
            position: location,
            map: map,
            title: address,
          });
          // 詳細情報ウィンドウの内容
          var contentString =
            "<div>サンプル<h3>" +
            address +
            '</h3><p>詳細情報がここに表示されます。</p><p><a href="https://www.tiktok.com/@yuuuuto38/video/7293401284609150216?q=%E7%A6%8F%E5%B2%A1%E8%A6%B3%E5%85%89&t=7150595195619282178" target="_blank">サイトへのリンク</a></p></div>';
          // ピンをクリックしたときのイベントリスナー
          marker.addListener("click", function () {
            // 詳細情報ウィンドウに内容をセット
            infoWindow.setContent(contentString);
            // ピンの位置にウィンドウを表示
            infoWindow.open(map, marker);
          });
        } else {
          alert("ジオコーディングに失敗しました: " + status);
        }
      });
    }
    var dataArray = JSON.parse(localStorage.getItem("Addresses"));
    //検索情報出力
    console.log(dataArray);
  </script>
  <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCUqiDP-1T8cxCyJRYrel2GIcAlz5_vgAE&callback=initMap"></script>
</body>
</html>