<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width,intial-scale=1"/>
    <meta charset="UTF-8" />
    <link rel="stylesheet" href="https://pyscript.net/latest/pyscript.css" />
    <link rel="stylesheet" href="./css/map.css">
    <script defer src="https://pyscript.net/latest/pyscript.js"></script>
    <title>Google Map with Info Window and Link</title>
    <style>
      #map {
        height: 400px;
        width: 100%;
      }
    </style>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.2/font/bootstrap-icons.min.css">
  </head>
  <body>
    <div id="map"></div>
    <div id="search-box-container" class="flex_test-box">
    <div class="flex_test-item">
      <form action="#">
        <!-- <label for="category">カテゴリ</label> -->
        <select id="category">
          <option value="sightseeing">観光</option>
          <option value="foods">グルメ</option>
        </select>
      <form action="#">
        <!-- <label for="place">県</label> -->
        <select name="place" id="place">
          <option value="ho">北海道</option>
          <option value="aomori">青森県</option>
          <option value="akita">秋田県</option>
          <option value="iwate">岩手県</option>
          <option value="miyagi">宮城県</option>
          <option value="yamagata">山形県</option>
          <option value="hukusima">福島県</option>
          <option value="tokyo">東京都</option>
          <option value="tiba">千葉県</option>
          <option value="saitama">埼玉県</option>
          <option value="kanagawa">神奈川県</option>
          <option value="gunma">群馬県</option>
          <option value="totigi">栃木県</option>
          <option value="ibaraki">茨城県</option>
          <option value="nigata">新潟県</option>
          <option value="yamanasi">山梨県</option>
          <option value="sizuoka">静岡県</option>
          <option value="nagano">長野県</option>
          <option value="gihu">岐阜県</option>
          <option value="aichi">愛知県</option>
          <option value="toyama">富山県</option>
          <option value="isii">石井県</option>
          <option value="hukui">福井県</option>
          <option value="kyoto">京都府</option>
          <option value="osaka">大阪府</option>
          <option value="siga">滋賀県</option>
          <option value="hyogo">兵庫県</option>
          <option value="nara">奈良県</option>
          <option value="wakayama">和歌山県</option>
          <option value="mie">三重県</option>
          <option value="totori">鳥取県</option>
          <option value="simane">島根県</option>
          <option value="okayama">岡山県</option>
          <option value="hirosima">広島県</option>
          <option value="yamaguti">山口県</option>
          <option value="ehime">愛媛県</option>
          <option value="koti">高知県</option>
          <option value="tokusima">徳島県</option>
          <option value="kagawa">香川県</option>
          <option value="hukuoka">福岡県</option>
          <option value="saga">佐賀県</option>
          <option value="nagaskai">長崎県</option>
          <option value="kumamoto">熊本県</option>
          <option value="oita">大分県</option>
          <option value="miyazaki">宮崎県</option>
          <option value="kagosima">鹿児島県</option>
          <option value="okinawa">沖縄県</option>
          </select>
          <button type="button" class="btn btn-primary">検索</button>
      </form>
    </div>
    </div>
    <div id="map"></div>
    <script>
      var map;
      var infoWindow;

      function initMap() {
        // マップを表示するためのオプションを設定
        var mapOptions = {
          center: { lat: 0, lng: 0 }, // マップの初期中心位置
          zoom: 15, // ズームレベル（1が最小、20が最大）
        };
        // 地図を作成
        var map = new google.maps.Map(
          document.getElementById("map"),
          mapOptions
        );
        // ユーザーの現在位置を取得して地図上に表示
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(
            function (position) {
              var userLocation = {
                lat: position.coords.latitude,
                lng: position.coords.longitude,
              };

              // ユーザーの位置にマーカーを追加
              new google.maps.Marker({
                position: userLocation,
                map: map,
                title: "現在の位置",
              });

              // マップをユーザーの位置に移動
              map.setCenter(userLocation);
              map.setZoom(15);
            },
            function (error) {
              // エラーメッセージを表示
              console.error(
                "位置情報を取得できませんでした。エラー: " + error.message
              );
            }
          );
        } else {
          // ブラウザが位置情報をサポートしていない場合のメッセージ
          console.error("このブラウザは位置情報をサポートしていません。");
        }

        // 情報ウィンドウを初期化
        infoWindow = new google.maps.InfoWindow();

        // ピンを立てたい住所
        var address =
          "水深162cmの日本一深い温泉がやばすぎた…173cmの俺は息出来なかった🤣 📍熊本県南小国町　こうの湯 #熊本 #こうの湯 #熊本温泉";

        // ジオコーディングを実行
        var geocoder = new google.maps.Geocoder();
        geocoder.geocode({ address: address }, function (results, status) {
          if (status === "OK") {
            var location = results[0].geometry.location;

            // ピンを作成
            var marker = new google.maps.Marker({
              position: location,
              map: map,
              title: address,
            });

            // 詳細情報ウィンドウの内容
            var contentString =
              "<div>サンプル<h3>" +
              address +
              '</h3><p>詳細情報がここに表示されます。</p><p><a href="https://www.tiktok.com/@yuuuuto38/video/7293401284609150216?q=%E7%A6%8F%E5%B2%A1%E8%A6%B3%E5%85%89&t=7150595195619282178" target="_blank">サイトへのリンク</a></p></div>';

            // ピンをクリックしたときのイベントリスナー
            marker.addListener("click", function () {
              // 詳細情報ウィンドウに内容をセット
              infoWindow.setContent(contentString);

              // ピンの位置にウィンドウを表示
              infoWindow.open(map, marker);
            });
          } else {
            alert("ジオコーディングに失敗しました: " + status);
          }
        });
      }
      var dataArray = JSON.parse(localStorage.getItem("Addresses"));
      //検索情報出力
      console.log(dataArray);
    </script>

    <script
      async
      defer
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCUqiDP-1T8cxCyJRYrel2GIcAlz5_vgAE&callback=initMap"
    ></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-Fy6S3B9q64WdZWQUiU+q4/2Lc9npb8tCaSX9FK7E8HnRr0Jz8D6OP9dO5Vg3Q9ct" crossorigin="anonymous"></script>
  </body>
</html>
